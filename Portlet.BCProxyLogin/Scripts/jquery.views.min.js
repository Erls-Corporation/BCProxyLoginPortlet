/*! JsViews v1.0pre: http://github.com/BorisMoore/jsviews */
this.jQuery&&jQuery.link||(function(f,n){var P="v1.0pre",q,e,c,N,L,w=f.jQuery,O=w.views,s=O.sub,K=false,t=true,v=null,G=O.topView,h=O.templates,F=w.observable,i="_jsvData",x="link",g="view",z="propertyChange",H="arrayChange",l={value:"val",input:"val",html:"html",text:"text"},o={from:{fromAttr:"value"},to:{toAttr:"value"}};oldCleanData=w.cleanData,oldJsvDelimiters=O.delimiters,rStartTag=/^jsvi|^jsv:/,rFirstElem=/^\s*<(\w+)[>\s]/;if(!w){throw"requires jQuery"}if(!(O)){throw"requires JsRender"}function m(ab){var X,af,U,ac,ag,ae,ad,Z,T=ab.target,Y=w(T),aa=w.view(T),V=aa.ctx,W=V.beforeChange;if(T.getAttribute(O.linkAttr)&&(ac=a(T,"to"))){U=k(T);X=l[U];ae=w.isFunction(U)?U(T):X?Y[X]():Y.attr(U);if((!W||!(af=W.call(aa,ab)===K))&&ae!==n){ad=O.converters[ac[2]];Z=ac[0];ac=ac[1];ag={src:T,tgt:Z,cnvtBack:ad,path:ac};if(ad){ae=ad.call(ag,ae)}if(ae!==n&&Z){F(Z).setProperty(ac,ae);if(V.afterChange){V.afterChange.call(ag,ab)}}ab.stopPropagation()}if(af){ab.stopImmediatePropagation()}}}function M(ah,U,ae){var Z,aa,ai,ab,X,ag=this,T=ag.src,ad=ag.tgt,W=w(ad),ac=ag.attr||k(ad,t),af=ag.view,V=af.ctx,Y=V.beforeChange;if((!Y||!(U&&Y.call(this,ah,U)===K))&&!(U&&ah.data!==U.path)){ai=ag.fn(T,ag.view,O,ae||r);if(w.isFunction(ai)){ai=ai.call(T)}if(ac==="visible"){ac="css-display";ai=ai?"block":"none"}if(ab=ac.lastIndexOf("css-",0)===0&&ac.substr(4)){if(aa=W.css(ab)!==ai){W.css(ab,ai)}}else{if(ac==="value"){if(ad.type==="radio"){if(ad.value===ai){ai=t;ac="checked"}else{return}}}Z=l[ac];if(Z){if(aa=W[Z]()!==ai){if(ac==="html"){W[Z](ai);if(U){af.link(T,ad,n,null)}}else{W[Z](ai)}if(ad.nodeName.toLowerCase()==="input"){W.blur()}}}else{if(aa=W.attr(ac)!==ai){W.attr(ac,ai)}}}if(U&&aa&&V.afterChange){V.afterChange.call(ag,ah,U)}}}function Q(V,T){var U=this.ctx,W=U.beforeChange;if(!W||W.call(this,V,T)!==K){this.onDataChanged(T);if(U.afterChange){U.afterChange.call(this,V,T)}}}function S(T){var U,W=T.data,V=T._onArrayChange;if(V){if(V[1]===W){return}w([V[1]]).unbind(H,V[0])}if(w.isArray(W)){U=function(){Q.apply(T,arguments)};w([W]).bind(H,U);T._onArrayChange=[U,W]}}function k(U,V){var T=O.merge[U.nodeName.toLowerCase()];return T?(V?T.to.toAttr:T.from.fromAttr):V?"html":""}function r(T){return T}function A(W,T,V,Z){var Y,U,X;if(!W.link){Z&&Z.push(W);W.onDataChanged=d;W.render=u;W.link=p;W.addViews=I;W.removeViews=b;W.content=E;W.prevNode=V;W.parentElem=T;if(W.parent){if(!w.isArray(W.data)){W.nodes=[];W._lnk=0}U=W.parent.views;if(w.isArray(U)){Y=W.key;X=U.length;while(Y++<X-1){F(U[Y]).setProperty("index",Y)}}S(W)}if(W.tmpl.presenter){W.presenter=new W.tmpl.presenter(W.ctx,W)}}return W}function d(V){if(V){var U=this,X=V.change,W=V.index,T=V.items;switch(X){case"insert":U.addViews(W,T);break;case"remove":U.removeViews(W,T.length);break;case"move":U.render();break;case"refresh":U.render()}}return t}function u(V){var U=this,T=U.tmpl=R(U.tmpl);if(T){w(U.nodes).remove();U.removeViews();U.nodes=[];y(U,U.key,U.parent.views,U.data,T.render(U.data,V,n,t,U),V);S(U)}return U}function I(W,V,U){var T=this;if(V.length&&(U=R(U||T.tmpl))){y(T,W,T.views,V,U.render(V,T.ctx,n,W,T),T.ctx)}return T}function y(aa,Y,ac,V,W,U){var X,T,ab,ad,Z=!aa.prevNode;parentNode=aa.parentElem;if(Y&&(""+Y!==Y)){X=ac[Y-1];if(!X){return}T=Z?X.following:X.nextNode}else{T=Z?aa.preceding:aa.prevNode.previousSibling}if(T){ab=T.nextSibling;w(T).after(W);T=T.nextSibling}else{ab=parentNode.firstChild;w(parentNode).prepend(W);T=parentNode.firstChild}ad=T&&T.previousSibling;parentNode.removeChild(T);parentNode.removeChild(ab?ab.previousSibling:parentNode.lastChild);aa.link(V,parentNode,U,ad,ab,Y)}function b(X,T){function Y(ae){var af,ac=U[ae],ag=ac.prevNode,ab=ac.nextNode,ad=ag?[ag]:ac.nodes;af=Z.length;if(af){ac.removeViews()}while(af--){if(Z[af]===ac){Z.splice(af,1);break}}while(ag!==ab){ag=ag.nextSibling;ad.push(ag)}w(ad).remove();ac.data=n;S(ac)}var aa,W=this,U=W.views,V=U.length,Z=Z||a(W.parentElem,g);if(X===n){if(V===n){for(X in U){Y(X)}W.views={}}else{aa=V;while(aa--){Y(aa)}W.views=[]}}else{if(T===n){if(V===n){Y(X);delete U[X]}else{T=1}}if(T){aa=X+T;while(aa-->X){Y(aa)}U.splice(X,T);if(V=U.length){while(X<V){F(U[X]).setProperty("index",X++)}}}}return this}function E(T){return T?w(T,this.nodes):w(this.nodes)}function p(W,X,U,T,V,Y){var aa=this,Z=aa.views;Y=Y||0;X=(""+X===X?w(X)[0]:X);function ab(al,ad,ag,ai){var aj,ak,ah,am,ac,ae,an,af;if(ad===n){D(al,aa,W)}node=(ad&&ad.nextSibling)||al.firstChild;while(node&&node!==ag){ah=node.nodeType;ak=ah===1;ae=node.nextSibling;if(ak&&(linkInfo=node.getAttribute("jsvtmpl"))||ah===8&&(linkInfo=node.nodeValue.split("jsv")[1])){af=linkInfo.charAt(0)!=="/"&&linkInfo;if(ak){ak=node.tagName;al.removeChild(node);node=v}if(af){af=af.slice(1);am=af||Y++;ac=ac||a(al,g,t);aj=A(aa.views[am],al,node,ac);if(ak&&af){aj.preceding=ae.previousSibling;ac.elLinked=ak}ae=aj.link(n,al,n,ae.previousSibling)}else{aa.nextNode=node;if(ak&&linkInfo==="/i"){X.insertBefore(aa.following=document.createTextNode(" "),ae)}if(ak&&linkInfo==="/t"&&ae&&ae.tagName&&ae.getAttribute("jsvtmpl")){X.insertBefore(document.createTextNode(" "),ae)}if(an=aa.ctx.onAfterCreate){an.call(aa,aa)}return ae}}else{if(ai&&aa.parent&&aa.nodes){aa.nodes.push(node)}if(ak){ab(node)}}node=ae}}return ab(X,T,V,t)}function j(X,T,V,U,W,ab,af){function Z(){m.apply({tgt:X},arguments)}T=w(T);var Y,ac,ae=this,aa=T[0],ad=ae.markup&&ae||ae.jquery&&w.templates(ae[0]);if(aa){af=af||w.view(aa);V=V||af.ctx;V.onRender=(V.link!==K)&&B;T.bind("change",Z);if(ad){Y=ad.render(X,V,n,n,af);if(V.target==="replace"){U=aa.previousSibling;W=aa.nextSibling;aa=aa.parentNode;T.replaceWith(Y)}else{U=W=n;T.empty().append(Y)}}af.link(X,aa,V,U,W,ab)}}function D(V,Z,X){var ae,ab,ad,Y,aa,ac,T,W,U=V.getAttribute(O.linkAttr);if(U){ad=Z._lnk++;ae=Z.links||Z.tmpl.links;if(!(j=ae[ad])){j=ae[ad]={};if(U.charAt(U.length-1)!=="}"){U=c+":"+U+(k(V)?":":"")+N}while(tokens=q.exec(U)){ab=tokens[1];ac=tokens[2];if(tokens[5]){if(!ab&&(Y=/^.*:([\w$]*)$/.exec(tokens[8]))){Y=Y[1];if(aa=Y.length){ac=tokens[2].slice(0,-aa-1)+N}}if(Y===v){Y=n}}j[ab]=O.tmplFn(e+ac+L,n,t);if(!ab&&Y!==n){j[ab].to=Y}}}T=Z.data;Z.data=T||X;for(ab in j){J(Z.data||X,V,ab,j[ab],Z)}Z.data=T}}function J(Z,aa,T,X,U){var V=[],W=a(aa,x,t),Y=function(){M.apply({tgt:aa,src:Z,attr:T,fn:X,view:U},arguments)};W[T]={srcs:V,hlr:Y};Y(n,n,function(ab,ac){V.push(ab);if(X.to!==n){w.data(aa,i).to=[ab,ac,X.to]}if(w.isArray(ab)){w([ab]).bind(H,function(){Y()})}else{w(ab).bind(z,ac,Y)}return ab})}function a(V,U,T){var W=w.data(V,i)||(T&&w.data(V,i,{view:[],link:{}}));return W?W[U]:{}}function C(T){return T.type==="checkbox"?T.checked:w(T).val()}function R(T){if(""+T===T){var U=T.split("[");T=h[U.shift()];while(T&&U.length){T=T.tmpls[U.shift().slice(0,-1)]}}return T}s.onStoreItem=function(T,U,V,W){if(U&&V&&T===h){w.link[U]=V.link=function(){w.link.apply(V,arguments)}}};function B(Y,X,W,Z,aa){var V,ab=X.tag,U="i",T="/i";if(!ab){ab=rFirstElem.exec(X.markup);ab=X.tag=(ab||(ab=rFirstElem.exec(Y)))&&ab[1]}if(Z){U=":"+Z;T="/t"}if(/^(option|optgroup|li|tr|td)$/.test(ab)){V="<"+ab+' jsvtmpl="';return V+U+'"/>'+w.trim(Y)+V+T+'"/>'}return"<!--jsv"+U+"-->"+Y+"<!--jsv"+T+"-->"}w.extend(O,{linkAttr:"data-link",merge:{input:{from:{fromAttr:C},to:{toAttr:"value"}},textarea:o,select:o,optgroup:{from:{fromAttr:"label"},to:{toAttr:"label"}}},delimiters:function(T,U){oldJsvDelimiters(T,U);e=T.charAt(0);c=T.charAt(1);N=U.charAt(0);L=U.charAt(1);q=new RegExp("(?:^|\\s*)([\\w-]*)("+O.rTag+")"+N+")","g");return this}});w.extend({view:function(V,ad){V=(""+V===V?w(V)[0]:V);var Y,Z,T,X,W,ab,aa,ac=f.document.body,U=V;if(ad){ab=V.nextSibling||V.parentNode;while(ab!==(V=V.firstChild||V.nextSibling||V.parentNode.nextSibling)){if(V.nodeType===8&&rStartTag.test(V.nodeValue)){Z=w.view(V);if(Z.prevNode===V){return Z}}}return}V=V||ac;if(w.isEmptyObject(G.views)){return G}else{while(!(T=a(ab=V.parentNode||ac,g)).length){if(!ab||V===ac){a(ac.parentNode,g,t).push(Y=G);break}V=ab}if(V===ac){return G}if(T.elLinked){X=T.length;while(--X){Z=T[X];W=Z.nodes.length;while(W--){if(Z.nodes[W]===V){return Z}}}}else{while(V){if(V===ab){return Z}if(V.nodeType===8){if(/^jsv\/[it]$/.test(V.nodeValue)){X=T.length;while(X--){Z=T[X];if(Z.nextNode===V){if(V===U){return Z}V=Z.prevNode;break}}}else{if(rStartTag.test(V.nodeValue)){X=T.length;while(X--){Z=T[X];if(Z.prevNode===V){return Z}}}}}V=V.previousSibling}}Y=Y||w.view(ab)}return Y},link:j,cleanData:function(U){var W,V,aa,Z,ad,ab,X,T,ac,Y=U.length;while(Y--){V=U[Y];if(T=w.data(V,i)){ac=T.link;for(Z in ac){aa=ac[Z];X=aa.srcs;W=X.length;while(W--){w(X[W]).unbind(z,aa.hlr)}}ac=T.view;if(W=ac.length){ad=w.view(V);while(W--){ab=ac[W];if(ab.parent===ad){ad.removeViews(ab.key)}}}}}oldCleanData.call(w,U)}});w.fn.link=j;O.delimiters("{{","}}");G._lnk=0;G.links=[];A(G)})(this);